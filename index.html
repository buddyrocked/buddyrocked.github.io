<!DOCTYPE html>
<html>
<body>
<!--<h1>Aplikasi Absen Guru</h1>-->
<p>Tekan Tombol <strong>ABSEN</strong> untuk kehadiran</p>

<button onclick="getLocation()">ABSEN MASUK</button>

<p id="demo"></p>
<div id="result"></div>
<div id="reader" width="800px"></div>
<div id="button-camera"></div>


<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script>
const x = document.getElementById("demo");
const resultContainer = document.getElementById("result");
const buttonContainer = document.getElementById("button-camera");

const latitude1 = -6.308486805414364;
const longitude1 = 106.72586182495347;

getListCamera();

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }

  html5QrcodeScanner.render(onScanSuccess, onScanError);  
}

function showPosition(position) {
  var range = showRange(latitude1, longitude1, position.coords.latitude, position.coords.longitude);
  x.innerHTML = "Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude + "<br>Jarak: " + range;
}


function onScanSuccess(decodedText, decodedResult) {
    // Handle on success condition with the decoded text or result.
    console.log(`Scan result: ${decodedText}`, decodedResult);
    resultContainer.innerHTML = `Scan result: ${decodedText}`;
    html5QrcodeScanner.clear();
}

function onScanError(errorMessage) {
  resultContainer.innerHTML = errorMessage;
}

let config = {
    fps: 10, 
    qrbox: 800,
    rememberLastUsedCamera: true,
    supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA]
}

var html5QrcodeScanner = new Html5QrcodeScanner(
	"reader", 
    config,
    /* verbose= */ false
);

function getListCamera() {
    // This method will trigger user permissions
    Html5Qrcode.getCameras().then(devices => {
        /**
         * devices would be an array of objects of type:
         * { id: "id", label: "label" }
         */
        if (devices && devices.length) {
            devices.forEach(renderButton);
        }
    }).catch(err => {
        console.log(err);
    });
}

function renderButton(item, index) {
    var z = document.createElement('div'); // is a node
    z.innerHTML = '<div><button onclick="scan(' + item.id  + ')">' + item.label  + '</button></div>';
    buttonContainer.appendChild(z);
}


function showRange(lat1, lon1, lat2, lon2)
{
  var R = 6371; // km
      var dLat = toRad(lat2-lat1);
      var dLon = toRad(lon2-lon1);
      var lat1 = toRad(lat1);
      var lat2 = toRad(lat2);

      var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
      var d = R * c;
      return d;
}

// Converts numeric degrees to radians
function toRad(Value) 
{
    return Value * Math.PI / 180;
}

</script>

</body>
</html>

