<!DOCTYPE html>
<html>
<body>
<h1>Aplikasi Absen Guru</h1>
<p>Tekan Tombol <strong>ABSEN</strong> untuk kehadiran</p>

<button onclick="getLocation()">ABSEN MASUK</button>

<p id="demo"></p>
<div id="reader" width="600px"></div>

<div style="width: 500px" id="reader"></div>

<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script>
const x = document.getElementById("demo");
const camreasContainer = document.getElementById("cameras");

const latitude1 = -6.308486805414364;
const longitude1 = 106.72586182495347;

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
  html5QrcodeScanner.render(onScanSuccess, onScanError);  
}

function showPosition(position) {
  var range = showRange(latitude1, longitude1, position.coords.latitude, position.coords.longitude);
  x.innerHTML = "Latitude: " + position.coords.latitude + 
  "<br>Longitude: " + position.coords.longitude + 
  "<br>Jarak: " + range;
}


function onScanSuccess(decodedText, decodedResult) {
    // Handle on success condition with the decoded text or result.
    console.log(`Scan result: ${decodedText}`, decodedResult);
    html5QrcodeScanner.clear();
}

function onScanError(errorMessage) {
  alert(errorMessage);
    // handle on error condition, with error message
}

var html5QrcodeScanner = new Html5QrcodeScanner(
	"reader", { fps: 10, qrbox: 250 }
);


function showRange(lat1, lon1, lat2, lon2)
{
  var R = 6371; // km
      var dLat = toRad(lat2-lat1);
      var dLon = toRad(lon2-lon1);
      var lat1 = toRad(lat1);
      var lat2 = toRad(lat2);

      var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
      var d = R * c;
      return d;
}

// Converts numeric degrees to radians
function toRad(Value) 
{
    return Value * Math.PI / 180;
}

</script>

</body>
</html>

