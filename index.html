<!DOCTYPE html>
<html style="background-color: rgb(240, 240, 240); height: auto;">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Bootstrap demo</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <style>
            
            body.mobile-view {
                max-width: 500px;
                margin: auto;
                padding-bottom: 50px;
            }
            .body-login {
                background-color: #32642d !important;
            }

            #reader {
                width: 100%;
                min-height: 250px;
                background: #f6f5f5;
                margin-bottom: 30px;
                text-align: center !important;
                vertical-align: auto;
            }

            a {
                text-decoration: none;
            }

            #reader > div > img {
                display: none !important;
            }

            #html5-qrcode-button-camera-stop {

            }
        </style>
    </head>
    <body class="sidebar-mini layout-fixed body-login mobile-view" style="height: auto;">
        <main class="login-form">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-12">
                        <div class="cardx" style="margin-top:0px;">
                            <div class="card-body">
                                <div>
                                   &nbsp;
                                </div>
                                <div class="d-grid mx-auto">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="login-logo">
                                                <div class="row">
                                                    <div class="col-12 text-center text-white">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="5em" height="5em" fill="currentColor" class="bi bi-mortarboard text-warning" viewBox="0 0 16 16">
                                                            <path d="M8.211 2.047a.5.5 0 0 0-.422 0l-7.5 3.5a.5.5 0 0 0 .025.917l7.5 3a.5.5 0 0 0 .372 0L14 7.14V13a1 1 0 0 0-1 1v2h3v-2a1 1 0 0 0-1-1V6.739l.686-.275a.5.5 0 0 0 .025-.917l-7.5-3.5ZM8 8.46 1.758 5.965 8 3.052l6.242 2.913L8 8.46Z"/>
                                                            <path d="M4.176 9.032a.5.5 0 0 0-.656.327l-.5 1.7a.5.5 0 0 0 .294.605l4.5 1.8a.5.5 0 0 0 .372 0l4.5-1.8a.5.5 0 0 0 .294-.605l-.5-1.7a.5.5 0 0 0-.656-.327L8 10.466 4.176 9.032Zm-.068 1.873.22-.748 3.496 1.311a.5.5 0 0 0 .352 0l3.496-1.311.22.748L8 12.46l-3.892-1.556Z"/>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>
                                            <h3 class="text-center text-white text-bold">APLIKASI ABSENSI</h3>
                                        </div>
                                        <div class="col-12">&nbsp;</div>
                                        <div class="col-12 text-white text-center text-bold"></div>
                                        <div class="col-12">&nbsp;</div>
                                        <div class="col-12">
                                            <div id="reader" width="800px" height="300px">
                                                <!--<svg xmlns="http://www.w3.org/2000/svg" width="250" height="250" fill="#ffc107" class="bi bi-check-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg>-->
                                            </div>
                                            <div class="d-grid gap-2">
                                                <button onclick="getLocation()" class="btn btn-warning btn-lg btn-block">MULAI ABSEN KELAS</button>
                                            </div>

                                            <p id="demo"></p>
                                            <div id="result"></div>
                                        </div>
                                        <div class="col-12 pt-5">
                                            <div class="alert alert-light" role="alert">
                                                <div class="row">
                                                    <div class="col-2 text-center">
                                                        <span class="align-middle">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" fill="currentColor" class="bi bi-megaphone" viewBox="0 0 16 16">
                                                                <path d="M13 2.5a1.5 1.5 0 0 1 3 0v11a1.5 1.5 0 0 1-3 0v-.214c-2.162-1.241-4.49-1.843-6.912-2.083l.405 2.712A1 1 0 0 1 5.51 15.1h-.548a1 1 0 0 1-.916-.599l-1.85-3.49a68.14 68.14 0 0 0-.202-.003A2.014 2.014 0 0 1 0 9V7a2.02 2.02 0 0 1 1.992-2.013 74.663 74.663 0 0 0 2.483-.075c3.043-.154 6.148-.849 8.525-2.199V2.5zm1 0v11a.5.5 0 0 0 1 0v-11a.5.5 0 0 0-1 0zm-1 1.35c-2.344 1.205-5.209 1.842-8 2.033v4.233c.18.01.359.022.537.036 2.568.189 5.093.744 7.463 1.993V3.85zm-9 6.215v-4.13a95.09 95.09 0 0 1-1.992.052A1.02 1.02 0 0 0 1 7v2c0 .55.448 1.002 1.006 1.009A60.49 60.49 0 0 1 4 10.065zm-.657.975 1.609 3.037.01.024h.548l-.002-.014-.443-2.966a68.019 68.019 0 0 0-1.722-.082z"/>
                                                            </svg>
                                                        </span>
                                                    </div>
                                                    <div class="col-10">
                                                        <div class="text-bold">
                                                            Selamat Datang
                                                        </div>
                                                        <div class="text-sm">
                                                            Mohon gunakan tombol <span class="text-bold text-warning">Kuning</span> untuk melakukan absensi di kelas.
                                                        </div>
                                                        <!-- Modal -->
                                                        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="exampleModalLabel">&nbsp;</h5>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        ...
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="button" class="btn btn-primary">Save changes</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">&nbsp;</div>
                                        <div class="col-12 text-white">
                                            <div class="text-bold text-sm text-center pb-4">Hubungi Kami</div>
                                            <div class="row">
                                                <div class="col-12">
                                                    <div class="row">
                                                        <div class="col-12 text-center pb-2">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-whatsapp" viewBox="0 0 16 16">
                                                                <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/>
                                                            </svg>
                                                        </div>
                                                        <div class="col-12 text-center">
                                                            <a href="https://wa.me/+628xxxxxxxxx/?text=halo, admin KKN" class="text-white text-sm">+08880000000</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 text-white text-center text-sm">
                        <div>&copy; copyright </div>
                    </div>
                </div>
            </div>
        </main>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
        <script>
            const x = document.getElementById("demo");
            const resultContainer = document.getElementById("result");
            const buttonContainer = document.getElementById("button-camera");
            const readerContainer = document.getElementById("reader");

            const latitude1 = -6.308486805414364;
            const longitude1 = 106.72586182495347;


            function scanQrCode(cameraId) {

            }

            function getLocation() {
                html5QrcodeScanner.render(onScanSuccess, onScanError);  
            }

            function showPosition(position) {
                var range = showRange(latitude1, longitude1, position.coords.latitude, position.coords.longitude);
                var link = "<a href='https://www.google.com/search?q=" + position.coords.latitude + "%2C+" + position.coords.longitude + "' target='_blank'>Anda melakukan absen disini</a>";
                x.innerHTML = "Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude + "<br>Jarak: " + range + "<br>" + link;
            }

            function onScanSuccess(decodedText, decodedResult) {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition);
                } else { 
                    x.innerHTML = "Geolocation is not supported by this browser.";
                }

                // Handle on success condition with the decoded text or result.
                console.log(`Scan result: ${decodedText}`, decodedResult);
                resultContainer.innerHTML = `Scan result: ${decodedText}`;
                //readerContainer.style.backgroundColor = "#32642d";
                readerContainer.innerHTML = '<div><svg xmlns="http://www.w3.org/2000/svg"  width="250" height="250" fill="#ffc107" class="bi bi-check-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg></div>';
                html5QrcodeScanner.clear();
            }

            function onScanError(errorMessage) {
                //resultContainer.innerHTML = errorMessage;
            }

            let config = {
                fps: 10, 
                qrbox: 300,
                rememberLastUsedCamera: true,
                supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA]
            }

            var html5QrcodeScanner = new Html5QrcodeScanner(
                "reader", 
                config,
                /* verbose= */ false
            );

            function getListCamera() {
                // This method will trigger user permissions
                Html5Qrcode.getCameras().then(devices => {
                    /**
                     * devices would be an array of objects of type:
                     * { id: "id", label: "label" }
                     */
                    if (devices && devices.length) {
                        devices.forEach(renderButton);
                    }
                }).catch(err => {
                    console.log(err);
                });
            }

            function renderButton(item, index) {
                var z = document.createElement('div'); // is a node
                z.innerHTML = '<div><button onclick="scanQrCode(' + item.id  + ')">' + item.label  + '</button></div>';
                buttonContainer.appendChild(z);
            }


            function showRange(lat1, lon1, lat2, lon2)
            {
                var R = 6371; // km
                var dLat = toRad(lat2-lat1);
                var dLon = toRad(lon2-lon1);
                var lat1 = toRad(lat1);
                var lat2 = toRad(lat2);

                var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
                var d = R * c;
                return d;
            }

            // Converts numeric degrees to radians
            function toRad(Value) 
            {
                return Value * Math.PI / 180;
            }

        </script>
    </body>
</html>

